{% extends "_components/base_site.html" %}
{% load static i18n %}

{% block title %}{% trans "Consultorio Dental Rodolfo Castell√≥n | Sistema integral" %}{% endblock %}
{% block meta_description %}{% trans "Atenci√≥n dental profesional en Puerto Vallarta. Citas en l√≠nea, pagos seguros." %}{% endblock %}

{% block extra_head %}
<link rel="preload" href="{% static 'img/fondodentista1.jpg' %}" as="image">
<link rel="stylesheet" href="{% static 'site.css' %}?v=FINAL_SEPARADO">
{% endblock %}

{% block content %}
<div class="bg-shapes">
  <div class="orb orb-a"></div>
  <div class="orb orb-b"></div>
  <div class="orb orb-c"></div>
</div>
<header class="hero">
  <div class="hero-overlay"></div>
  <div class="hero-inner wrap">
    <div class="kicker">{% trans "SISTEMA INTEGRAL ‚Ä¢ PUERTO VALLARTA" %}</div>
    <h1 class="hero-title reveal">{% trans "Consultorio Dental Rodolfo Castell√≥n" %}</h1>
    <p class="lead reveal">
        {% blocktrans %}<strong>Sistema integral</strong> para la <strong>gesti√≥n de pacientes, citas y pagos</strong>. Tecnolog√≠a moderna, trato humano y precios accesibles.{% endblocktrans %}
    </p>
    <div class="cta reveal">
      <a class="rc-btn whatsapp-btn" href="https://wa.me/523228892558" target="_blank">
          <i class="ph-fill ph-whatsapp-logo"></i> WhatsApp
      </a>
      <a href="{% url 'accounts:login' %}" class="rc-btn">{% trans "Iniciar sesi√≥n" %}</a>
      <a href="{% url 'accounts:register' %}" class="rc-btn rc-btn--primary">{% trans "Agenda tu cita" %}</a>
    </div>
    <div class="stats-grid reveal">
        <div class="stat-card"><h3>500+</h3><p>{% trans "Procedimientos" %}</p></div>
        <div class="stat-card"><h3>4.7/5 ‚ú®</h3><p>{% trans "Satisfacci√≥n" %}</p></div>
        <div class="stat-card"><h3>6+ {% trans "a√±os" %}</h3><p>{% trans "Experiencia" %}</p></div>
    </div>
  </div>
</header>

<main>
  <section id="servicios" class="bg-dark">
    <div class="wrap">
        <h2 class="section-title reveal">{% trans "Servicios principales" %}</h2>
        <p class="section-lead reveal">{% trans "Tratamientos personalizados para cada sonrisa." %}</p>
        
        <div class="grid-3 mt-3">
          <article class="svc-card reveal">
            <div class="svc-card-ico"><img src="{% static 'img/odontologia general.png' %}" alt="General"></div>
            <h3>{% trans "Odontolog√≠a General" %}</h3>
            <ul><li>{% trans "Limpieza profunda" %}</li><li>{% trans "Resinas" %}</li><li>{% trans "Extracciones" %}</li></ul>
          </article>
          <article class="svc-card reveal">
            <div class="svc-card-ico"><img src="{% static 'img/Ortodoncia.png' %}" alt="Ortodoncia"></div>
            <h3>{% trans "Ortodoncia" %}</h3>
            <ul><li>{% trans "Brackets est√©ticos" %}</li><li>{% trans "Alineadores" %}</li></ul>
          </article>
          <article class="svc-card reveal">
            <div class="svc-card-ico"><img src="{% static 'img/Odontolog√≠a est√©tica.png' %}" alt="Est√©tica"></div>
            <h3>{% trans "Est√©tica" %}</h3>
            <ul><li>{% trans "Blanqueamiento" %}</li><li>{% trans "Carillas" %}</li></ul>
          </article>
          <article class="svc-card reveal">
            <div class="svc-card-ico"><img src="{% static 'img/odontologia Restaurativa.png' %}" alt="Restaurativa"></div>
            <h3>{% trans "Restaurativa" %}</h3>
            <ul><li>{% trans "Coronas" %}</li><li>{% trans "Incrustaciones" %}</li></ul>
          </article>
          <article class="svc-card reveal">
            <div class="svc-card-ico"><img src="{% static 'img/protesis e implantes.png' %}" alt="Implantes"></div>
            <h3>{% trans "Pr√≥tesis" %}</h3>
            <ul><li>{% trans "Implantes dentales" %}</li><li>{% trans "Puentes" %}</li></ul>
          </article>
          <article class="svc-card reveal">
            <div class="svc-card-ico"><img src="{% static 'img/recordatorio.png' %}" alt="Agenda"></div>
            <h3>{% trans "Agenda Digital" %}</h3>
            <p>{% trans "Recordatorios autom√°ticos." %}</p>
          </article>
        </div>
    </div>
  </section>

  <section id="acerca" class="bg-panel">
    <div class="wrap">
        <div class="grid-2 align-center">
          <div class="reveal">
            <h2 class="section-title">{% trans "Acerca del consultorio" %}</h2>
            <p class="lead">{% trans "Ubicados en El Pitillal, Puerto Vallarta, ofrecemos tratamientos de √∫ltima generaci√≥n con un trato humano." %}</p>
            <ul class="feature-list">
                <li>{% trans "Horario flexible: Lunes, 7 am - 7pm y Sabados, 9 a 2" %}</li>
                <li>{% trans "Tecnolog√≠a moderna y ambiente seguro" %}</li>
                <li>{% trans "Atenci√≥n personalizada por el Dr. Castell√≥n" %}</li>
            </ul>
            <a href="{% url 'accounts:register' %}" class="rc-btn rc-btn--primary mt-2">{% trans "Quiero una valoraci√≥n" %}</a>
          </div>
          <div class="reveal">
            <img src="{% static 'img/dentista.jpg' %}" alt="Consultorio" class="feature-img">
          </div>
        </div>
    </div>
  </section>

  <section id="sistema" class="bg-dark">
    <div class="wrap">
      <div class="panel-card panel-grid reveal">
        <div>
          <h2 class="section-title" style="margin-bottom:0.5rem;">{% trans "Sistema digital RC" %}</h2>
          <p class="section-lead" style="margin-bottom:1.5rem;">{% trans "Agenda, pagos y recordatorios conectados para pacientes y dentistas." %}</p>
          <p class="lead" style="font-size:1.05rem; color:var(--muted);">{% trans "Un panel para el dentista y otro para el paciente, sincronizados con correos, penalizaciones y cobros en l√≠nea." %}</p>
          <div class="cta" style="justify-content:flex-start; margin-top:1.5rem;">
            <a href="{% url 'accounts:register' %}" class="rc-btn rc-btn--primary">{% trans "Crear mi cuenta" %}</a>
            <a href="{% url 'accounts:login' %}" class="rc-btn">{% trans "Acceder" %}</a>
          </div>
        </div>
        <div>
          <div class="pill-list">
            <div class="pill">
              <div class="pill-icon"><i class="ph-fill ph-calendar-check"></i></div>
              <div>
                <strong>{% trans "Agenda inteligente" %}</strong>
                <small>{% trans "Slots en tiempo real, reprogramaciones y confirmaciones por correo." %}</small>
              </div>
            </div>
            <div class="pill">
              <div class="pill-icon"><i class="ph-fill ph-credit-card"></i></div>
              <div>
                <strong>{% trans "Pagos con MercadoPago" %}</strong>
                <small>{% trans "Cobros seguros, recibos en PDF y conciliaci√≥n autom√°tica." %}</small>
              </div>
            </div>
            <div class="pill">
              <div class="pill-icon"><i class="ph-fill ph-bell"></i></div>
              <div>
                <strong>{% trans "Recordatorios 24h" %}</strong>
                <small>{% trans "Correos autom√°ticos antes de la cita y enlaces de confirmaci√≥n." %}</small>
              </div>
            </div>
            <div class="pill">
              <div class="pill-icon"><i class="ph-fill ph-shield-check"></i></div>
              <div>
                <strong>{% trans "Seguridad y acceso" %}</strong>
                <small>{% trans "Verificaci√≥n de email y control de penalizaciones por inasistencias." %}</small>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section id="pagos" class="bg-dark text-center">
    <div class="wrap pagos-wrap">
        <h2 class="section-title reveal">{% trans "Formas de pago" %}</h2>
        <p class="section-lead reveal pagos-sub">{% trans "Flexibilidad para tu comodidad." %}</p>
        <div class="badges reveal justify-center">
          <span class="badge"><i class="ph-fill ph-money"></i> {% trans "Efectivo" %}</span>
          <span class="badge active"><i class="ph-fill ph-credit-card"></i> {% trans "MercadoPago" %}</span>
          <span class="badge"><i class="ph-fill ph-bank"></i> {% trans "Transferencia" %}</span>
        </div>
    </div>
  </section>
  
  <section id="contacto" class="bg-panel">
    <div class="wrap">
        <div class="grid-2">
          <div class="cyber-card reveal">
            <h3>{% trans "Cont√°ctanos" %}</h3>
            <ul class="contact-list">
              <li><i class="ph-fill ph-phone text-brand"></i> <a href="tel:+523228892558">+52 322 889 2558</a></li>
              <li><i class="ph-fill ph-envelope text-brand"></i> dentista.choyo@gmail.com</li>
              <li><i class="ph-fill ph-map-pin text-brand"></i> {% trans "Calle Guatemala #125, El Pitillal" %}</li>
            </ul>
          </div>
          <div class="reveal map-container">
            <iframe title="{% trans 'Ubicaci√≥n' %}" loading="lazy" src="https://www.google.com/maps?q=Calle%20Guatemala%20125%20El%20Pitillal%20Puerto%20Vallarta&output=embed"></iframe>
          </div>
        </div>
    </div>
  </section>
</main>

<!-- Chat flotante -->
<div id="rc-chat-toggle" class="rc-chat-toggle">
  <i class="ph-bold ph-sparkle"></i>
  <span class="rc-pulse-dot"></span>
</div>
<div id="rc-chatbox" class="rc-chatbox"
  data-greeting="{% trans '¬°Hola! Soy tu asistente RC. Pregunta por horarios, pagos o penalizaciones.' %}"
  data-placeholder="{% trans 'Escribe tu pregunta...' %}"
  data-subtitle="{% trans 'Horarios, pagos y citas' %}"
  data-error="{% trans 'Error al conectar. Intenta de nuevo.' %}">
  <div class="rc-chat-header">
    <div class="rc-head-left">
      <div class="rc-avatar">RC</div>
      <div>
        <div class="rc-head-title">{% trans "Asistente RC" %}</div>
        <div class="rc-head-sub"><span class="rc-dot online"></span> {% trans "Horarios ¬∑ Pagos ¬∑ Citas" %}</div>
      </div>
    </div>
    <button id="rc-chat-close" class="rc-chat-close" aria-label="Cerrar chat"><i class="ph-bold ph-x"></i></button>
  </div>
  <div id="rc-chat-messages" class="rc-chat-messages"></div>
  <div class="rc-quick-replies" id="rc-quick-replies">
    <button class="rc-chip" data-msg="{% trans 'Quiero agendar una cita' %}">üóìÔ∏è {% trans "Agendar" %}</button>
    <button class="rc-chip" data-msg="{% trans '¬øC√≥mo pagar mi penalizaci√≥n?' %}">üí≥ {% trans "Penalizaci√≥n" %}</button>
    <button class="rc-chip" data-msg="{% trans '¬øCu√°les son los horarios disponibles?' %}">‚è∞ {% trans "Horarios" %}</button>
    <button class="rc-chip" data-msg="{% trans 'Ubicaci√≥n del consultorio' %}">üìç {% trans "Ubicaci√≥n" %}</button>
  </div>
  <form id="rc-chat-form" class="rc-chat-form">
    <input id="rc-chat-input" type="text" placeholder="{% trans 'Escribe tu pregunta...' %}" autocomplete="off" required />
    <button type="submit" aria-label="{% trans 'Enviar' %}"><i class="ph-bold ph-paper-plane-tilt"></i></button>
  </form>
</div>

{% endblock %}

{% block extra_js %}
<style>
  .rc-chat-toggle {
    position: fixed; bottom: 24px; right: 24px; z-index: 1200;
    background: linear-gradient(135deg, #22c55e, #0ea5e9);
    color: #0a0f1f; width: 64px; height: 64px; border-radius: 18px;
    display: grid; place-items: center; font-size: 24px; cursor: pointer;
    box-shadow: 0 16px 40px rgba(14,165,233,0.35), 0 0 0 1px rgba(255,255,255,0.05);
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }
  .rc-chat-toggle:hover { transform: translateY(-3px) scale(1.02); box-shadow: 0 22px 50px rgba(34,197,94,0.35), 0 0 0 1px rgba(255,255,255,0.08); }
  .rc-pulse-dot { position: absolute; width: 10px; height: 10px; background: #22c55e; border-radius: 999px; top: 8px; right: 8px; box-shadow: 0 0 0 0 rgba(34,197,94,0.5); animation: pulse 2s infinite; }
  @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(34,197,94,0.5); } 70% { box-shadow: 0 0 0 12px rgba(34,197,94,0); } 100% { box-shadow: 0 0 0 0 rgba(34,197,94,0); } }
  .rc-chatbox {
    position: fixed; bottom: 96px; right: 24px; width: 360px; max-height: 75vh;
    background: radial-gradient(circle at 20% 20%, rgba(34,197,94,0.1), transparent 45%), rgba(7, 12, 24, 0.94);
    color: #f8fafc; border-radius: 20px;
    box-shadow: 0 24px 70px rgba(0,0,0,0.55), 0 0 0 1px rgba(255,255,255,0.06);
    display: none; flex-direction: column; overflow: hidden; z-index: 1200;
    border: 1px solid rgba(255,255,255,0.08); backdrop-filter: blur(12px);
  }
  .rc-chat-header {
    padding: 14px 16px; background: linear-gradient(135deg, #0ea5e9, #22c55e);
    color: #0a0f1f; display: flex; align-items: center; justify-content: space-between;
    box-shadow: 0 12px 28px rgba(0,0,0,0.25);
  }
  .rc-head-left { display: flex; align-items: center; gap: 12px; }
  .rc-avatar { width: 44px; height: 44px; border-radius: 14px; background: rgba(255,255,255,0.82); color: #0a0f1f; display: grid; place-items: center; font-weight: 800; letter-spacing: 0.5px; }
  .rc-head-title { font-weight: 800; font-size: 1rem; }
  .rc-head-sub { font-size: 12px; opacity: 0.85; display: flex; align-items: center; gap: 6px; }
  .rc-dot { width: 8px; height: 8px; border-radius: 999px; display: inline-block; }
  .rc-dot.online { background: #16a34a; box-shadow: 0 0 0 6px rgba(22,163,74,0.18); }
  .rc-chat-close { background: rgba(255,255,255,0.14); border: 1px solid rgba(255,255,255,0.2); color: #0a0f1f; width: 38px; height: 38px; border-radius: 12px; cursor: pointer; display: grid; place-items: center; transition: transform 0.2s; }
  .rc-chat-close:hover { transform: translateY(-2px); }
  .rc-chat-messages { padding: 16px; overflow-y: auto; flex: 1; display: flex; flex-direction: column; gap: 12px; }
  .rc-bubble { padding: 12px 14px; border-radius: 14px; max-width: 90%; font-size: 14px; line-height: 1.5; position: relative; border: 1px solid transparent; }
  .rc-bubble.user { background: linear-gradient(135deg, #22c55e, #0ea5e9); color: #0a0f1f; margin-left: auto; font-weight: 700; box-shadow: 0 12px 30px rgba(14,165,233,0.25); }
  .rc-bubble.bot { background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.08); }
  .rc-badge { position: absolute; bottom: -10px; left: 12px; font-size: 10px; padding: 3px 6px; border-radius: 999px; background: rgba(255,255,255,0.08); color: #cbd5e1; text-transform: uppercase; letter-spacing: 0.4px; }
  .rc-bubble.ia .rc-badge { background: #22c55e; color: #0a0f1f; }
  .rc-quick-replies { padding: 10px 14px; border-top: 1px solid rgba(255,255,255,0.05); display: flex; gap: 8px; overflow-x: auto; scrollbar-width: none; background: rgba(255,255,255,0.02); }
  .rc-quick-replies::-webkit-scrollbar { display: none; }
  .rc-chip { border: 1px solid rgba(255,255,255,0.12); background: rgba(255,255,255,0.04); color: #e2e8f0; padding: 8px 12px; border-radius: 12px; font-size: 12px; cursor: pointer; transition: all 0.2s; white-space: nowrap; }
  .rc-chip:hover { background: rgba(34,197,94,0.2); color: #0a0f1f; border-color: rgba(34,197,94,0.4); }
  .rc-chat-form { display: flex; gap: 10px; padding: 12px 14px; border-top: 1px solid rgba(255,255,255,0.08); background: rgba(7,12,24,0.9); }
  .rc-chat-form input { flex: 1; padding: 12px 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.12); background: rgba(255,255,255,0.04); color: #e2e8f0; }
  .rc-chat-form input:focus { outline: none; border-color: rgba(14,165,233,0.6); box-shadow: 0 0 0 4px rgba(14,165,233,0.16); }
  .rc-chat-form button { background: linear-gradient(135deg, #22c55e, #0ea5e9); color: #0a0f1f; border: none; border-radius: 12px; padding: 0 14px; cursor: pointer; font-weight: 700; width: 46px; display: grid; place-items: center; box-shadow: 0 12px 26px rgba(34,197,94,0.28); }
  @media (max-width: 640px) {
    .rc-chatbox { right: 12px; left: 12px; width: auto; }
    .rc-chat-toggle { right: 12px; }
  }
</style>
<script>
  (function() {
    const toggle = document.getElementById("rc-chat-toggle");
    const chat = document.getElementById("rc-chatbox");
    const closeBtn = document.getElementById("rc-chat-close");
    const form = document.getElementById("rc-chat-form");
    const input = document.getElementById("rc-chat-input");
    const messages = document.getElementById("rc-chat-messages");
    const quicks = document.querySelectorAll("#rc-quick-replies .rc-chip");
    const endpoint = "/api/chatbot/";
    const t = {
      greeting: chat?.dataset.greeting || "Hello! I'm your RC assistant.",
      placeholder: chat?.dataset.placeholder || "Type your question...",
      error: chat?.dataset.error || "Connection error. Try again.",
    };

    if (input && t.placeholder) input.placeholder = t.placeholder;

    const append = (text, role, source, isLoading=false) => {
      const div = document.createElement("div");
      div.className = `rc-bubble ${role}`;
      if (source) div.classList.add(source);
      div.textContent = isLoading ? "..." : text;
      if (role === "bot" && source) {
        const badge = document.createElement("span");
        badge.className = "rc-badge";
        badge.textContent = source.toUpperCase();
        div.appendChild(badge);
      }
      messages.appendChild(div);
      messages.scrollTop = messages.scrollHeight;
      return div;
    };

    toggle.addEventListener("click", () => {
      chat.style.display = "flex";
      input.focus();
      if (!messages.dataset.seeded) {
        append(t.greeting, "bot");
        messages.dataset.seeded = "1";
      }
    });
    closeBtn.addEventListener("click", () => chat.style.display = "none");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const text = input.value.trim();
      if (!text) return;
      append(text, "user");
      input.value = "";
      const loader = append("...", "bot", null, true);
      try {
        const resp = await fetch(endpoint, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ query: text })
        });
        const data = await resp.json().catch(() => ({}));
        loader.remove();
        append(data.message || t.error, "bot", data.source);
      } catch (err) {
        loader.remove();
        append(t.error, "bot");
      }
    });

    quicks.forEach(btn => {
      btn.addEventListener("click", () => {
        const text = btn.dataset.msg || "";
        if (!text) return;
        input.value = text;
        form.dispatchEvent(new Event("submit"));
      });
    });
  })();
</script>
{% endblock %}
