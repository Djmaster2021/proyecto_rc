{% extends "_components/base_site.html" %}
{% load static i18n %}

{% block title %}{% trans "Consultorio Dental Rodolfo Castell√≥n | Sistema integral" %}{% endblock %}
{% block meta_description %}{% trans "Atenci√≥n dental profesional en Puerto Vallarta. Citas en l√≠nea, pagos seguros." %}{% endblock %}

{% block extra_head %}
<link rel="preload" href="{% static 'img/fondodentista1.jpg' %}" as="image">
<link rel="stylesheet" href="{% static 'site.css' %}?v=FINAL_SEPARADO">
{% endblock %}

{% block content %}
<div class="bg-shapes">
  <div class="orb orb-a"></div>
  <div class="orb orb-b"></div>
  <div class="orb orb-c"></div>
</div>
<header class="hero">
  <div class="hero-overlay"></div>
  <div class="hero-inner wrap">
    <div class="kicker">{% trans "SISTEMA INTEGRAL ‚Ä¢ PUERTO VALLARTA" %}</div>
    <h1 class="hero-title reveal">{% trans "Consultorio Dental Rodolfo Castell√≥n" %}</h1>
    <p class="lead reveal">
        {% blocktrans %}<strong>Sistema integral</strong> para la <strong>gesti√≥n de pacientes, citas y pagos</strong>. Tecnolog√≠a moderna, trato humano y precios accesibles.{% endblocktrans %}
    </p>
    <div class="cta reveal">
      <a class="rc-btn whatsapp-btn" href="https://wa.me/523228892558" target="_blank">
          <i class="ph-fill ph-whatsapp-logo"></i> WhatsApp
      </a>
      <a href="{% url 'accounts:login' %}" class="rc-btn">{% trans "Iniciar sesi√≥n" %}</a>
      <a href="{% url 'accounts:register' %}" class="rc-btn rc-btn--primary">{% trans "Agenda tu cita" %}</a>
    </div>
    <div class="stats-grid reveal">
        <div class="stat-card"><h3>500+</h3><p>{% trans "Procedimientos" %}</p></div>
        <div class="stat-card"><h3>4.7/5 ‚ú®</h3><p>{% trans "Satisfacci√≥n" %}</p></div>
        <div class="stat-card"><h3>6+ {% trans "a√±os" %}</h3><p>{% trans "Experiencia" %}</p></div>
    </div>
  </div>
</header>

<main>
  <section id="servicios" class="bg-dark">
    <div class="wrap">
        <h2 class="section-title reveal">{% trans "Servicios principales" %}</h2>
        <p class="section-lead reveal">{% trans "Tratamientos personalizados para cada sonrisa." %}</p>
        
        <div class="grid-3 mt-3">
          <article class="svc-card reveal">
            <div class="svc-card-ico"><img src="{% static 'img/odontologia general.png' %}" alt="General"></div>
            <h3>{% trans "Odontolog√≠a General" %}</h3>
            <ul><li>{% trans "Limpieza profunda" %}</li><li>{% trans "Resinas" %}</li><li>{% trans "Extracciones" %}</li></ul>
          </article>
          <article class="svc-card reveal">
            <div class="svc-card-ico"><img src="{% static 'img/Ortodoncia.png' %}" alt="Ortodoncia"></div>
            <h3>{% trans "Ortodoncia" %}</h3>
            <ul><li>{% trans "Brackets est√©ticos" %}</li><li>{% trans "Alineadores" %}</li></ul>
          </article>
          <article class="svc-card reveal">
            <div class="svc-card-ico"><img src="{% static 'img/Odontolog√≠a est√©tica.png' %}" alt="Est√©tica"></div>
            <h3>{% trans "Est√©tica" %}</h3>
            <ul><li>{% trans "Blanqueamiento" %}</li><li>{% trans "Carillas" %}</li></ul>
          </article>
          <article class="svc-card reveal">
            <div class="svc-card-ico"><img src="{% static 'img/odontologia Restaurativa.png' %}" alt="Restaurativa"></div>
            <h3>{% trans "Restaurativa" %}</h3>
            <ul><li>{% trans "Coronas" %}</li><li>{% trans "Incrustaciones" %}</li></ul>
          </article>
          <article class="svc-card reveal">
            <div class="svc-card-ico"><img src="{% static 'img/protesis e implantes.png' %}" alt="Implantes"></div>
            <h3>{% trans "Pr√≥tesis" %}</h3>
            <ul><li>{% trans "Implantes dentales" %}</li><li>{% trans "Puentes" %}</li></ul>
          </article>
          <article class="svc-card reveal">
            <div class="svc-card-ico"><img src="{% static 'img/recordatorio.png' %}" alt="Agenda"></div>
            <h3>{% trans "Agenda Digital" %}</h3>
            <p>{% trans "Recordatorios autom√°ticos." %}</p>
          </article>
        </div>
    </div>
  </section>

  <section id="acerca" class="bg-panel">
    <div class="wrap">
        <div class="grid-2 align-center">
          <div class="reveal">
            <h2 class="section-title">{% trans "Acerca del consultorio" %}</h2>
            <p class="lead">{% trans "Ubicados en El Pitillal, Puerto Vallarta, ofrecemos tratamientos de √∫ltima generaci√≥n con un trato humano." %}</p>
            <ul class="feature-list">
                <li>{% trans "Horario flexible: Lunes, 7 am - 7pm y Sabados, 9 a 2" %}</li>
                <li>{% trans "Tecnolog√≠a moderna y ambiente seguro" %}</li>
                <li>{% trans "Atenci√≥n personalizada por el Dr. Castell√≥n" %}</li>
            </ul>
            <a href="{% url 'accounts:register' %}" class="rc-btn rc-btn--primary mt-2">{% trans "Quiero una valoraci√≥n" %}</a>
          </div>
          <div class="reveal">
            <img src="{% static 'img/dentista.jpg' %}" alt="Consultorio" class="feature-img">
          </div>
        </div>
    </div>
  </section>

  <section id="sistema" class="bg-dark">
    <div class="wrap">
      <div class="panel-card panel-grid reveal">
        <div>
          <h2 class="section-title" style="margin-bottom:0.5rem;">{% trans "Sistema digital RC" %}</h2>
          <p class="section-lead" style="margin-bottom:1.5rem;">{% trans "Agenda, pagos y recordatorios conectados para pacientes y dentistas." %}</p>
          <p class="lead" style="font-size:1.05rem; color:var(--muted);">{% trans "Un panel para el dentista y otro para el paciente, sincronizados con correos, penalizaciones y cobros en l√≠nea." %}</p>
          <div class="cta" style="justify-content:flex-start; margin-top:1.5rem;">
            <a href="{% url 'accounts:register' %}" class="rc-btn rc-btn--primary">{% trans "Crear mi cuenta" %}</a>
            <a href="{% url 'accounts:login' %}" class="rc-btn">{% trans "Acceder" %}</a>
          </div>
        </div>
        <div>
          <div class="pill-list">
            <div class="pill">
              <div class="pill-icon"><i class="ph-fill ph-calendar-check"></i></div>
              <div>
                <strong>{% trans "Agenda inteligente" %}</strong>
                <small>{% trans "Slots en tiempo real, reprogramaciones y confirmaciones por correo." %}</small>
              </div>
            </div>
            <div class="pill">
              <div class="pill-icon"><i class="ph-fill ph-credit-card"></i></div>
              <div>
                <strong>{% trans "Pagos con MercadoPago" %}</strong>
                <small>{% trans "Cobros seguros, recibos en PDF y conciliaci√≥n autom√°tica." %}</small>
              </div>
            </div>
            <div class="pill">
              <div class="pill-icon"><i class="ph-fill ph-bell"></i></div>
              <div>
                <strong>{% trans "Recordatorios 24h" %}</strong>
                <small>{% trans "Correos autom√°ticos antes de la cita y enlaces de confirmaci√≥n." %}</small>
              </div>
            </div>
            <div class="pill">
              <div class="pill-icon"><i class="ph-fill ph-shield-check"></i></div>
              <div>
                <strong>{% trans "Seguridad y acceso" %}</strong>
                <small>{% trans "Verificaci√≥n de email y control de penalizaciones por inasistencias." %}</small>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section id="pagos" class="bg-dark text-center">
    <div class="wrap pagos-wrap">
        <h2 class="section-title reveal">{% trans "Formas de pago" %}</h2>
        <p class="section-lead reveal pagos-sub">{% trans "Flexibilidad para tu comodidad." %}</p>
        <div class="badges reveal justify-center">
          <span class="badge"><i class="ph-fill ph-money"></i> {% trans "Efectivo" %}</span>
          <span class="badge active"><i class="ph-fill ph-credit-card"></i> {% trans "MercadoPago" %}</span>
          <span class="badge"><i class="ph-fill ph-bank"></i> {% trans "Transferencia" %}</span>
        </div>
    </div>
  </section>
  
  <section id="contacto" class="bg-panel">
    <div class="wrap">
        <div class="grid-2">
          <div class="cyber-card reveal">
            <h3>{% trans "Cont√°ctanos" %}</h3>
            <ul class="contact-list">
              <li><i class="ph-fill ph-phone text-brand"></i> <a href="tel:+523228892558">+52 322 889 2558</a></li>
              <li><i class="ph-fill ph-envelope text-brand"></i> dentista.choyo@gmail.com</li>
              <li><i class="ph-fill ph-map-pin text-brand"></i> {% trans "Calle Guatemala #125, El Pitillal" %}</li>
            </ul>
          </div>
          <div class="reveal map-container">
            <iframe title="{% trans 'Ubicaci√≥n' %}" loading="lazy" src="https://www.google.com/maps?q=Calle%20Guatemala%20125%20El%20Pitillal%20Puerto%20Vallarta&output=embed"></iframe>
          </div>
        </div>
    </div>
  </section>
</main>

<!-- Chat flotante -->
<div id="rc-chat-toggle" class="rc-chat-toggle">
  <span>üí¨</span>
</div>
<div id="rc-chatbox" class="rc-chatbox"
  data-greeting="{% trans '¬°Hola! Soy tu asistente RC. Pregunta por horarios, pagos o penalizaciones.' %}"
  data-placeholder="{% trans 'Escribe tu pregunta...' %}"
  data-subtitle="{% trans 'Horarios, pagos y citas' %}"
  data-error="{% trans 'Error al conectar. Intenta de nuevo.' %}">
  <div class="rc-chat-header">
    <div>
      <strong>{% trans "Asistente RC" %}</strong>
      <div class="rc-chat-sub">{% trans "Horarios, pagos y citas" %}</div>
    </div>
    <button id="rc-chat-close" class="rc-chat-close" aria-label="Cerrar chat">√ó</button>
  </div>
  <div id="rc-chat-messages" class="rc-chat-messages"></div>
  <form id="rc-chat-form" class="rc-chat-form">
    <input id="rc-chat-input" type="text" placeholder="{% trans 'Escribe tu pregunta...' %}" autocomplete="off" required />
    <button type="submit">{% trans "Enviar" %}</button>
  </form>
</div>

{% endblock %}

{% block extra_js %}
<style>
  .rc-chat-toggle {
    position: fixed; bottom: 24px; right: 24px; z-index: 1200;
    background: linear-gradient(135deg, #22c55e, #0ea5e9);
    color: #fff; width: 56px; height: 56px; border-radius: 50%;
    display: grid; place-items: center; font-size: 24px; cursor: pointer;
    box-shadow: 0 10px 30px rgba(0,0,0,0.25);
  }
  .rc-chatbox {
    position: fixed; bottom: 96px; right: 24px; width: 320px; max-height: 70vh;
    background: #0b1220; color: #f8fafc; border-radius: 16px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.35);
    display: none; flex-direction: column; overflow: hidden; z-index: 1200;
    border: 1px solid rgba(255,255,255,0.08);
  }
  .rc-chat-header {
    padding: 12px 14px; background: linear-gradient(135deg, #0ea5e9, #2563eb);
    color: #fff; display: flex; align-items: center; justify-content: space-between;
  }
  .rc-chat-sub { font-size: 12px; opacity: 0.85; }
  .rc-chat-close { background: transparent; border: none; color: #fff; font-size: 20px; cursor: pointer; }
  .rc-chat-messages { padding: 12px; overflow-y: auto; flex: 1; display: flex; flex-direction: column; gap: 10px; }
  .rc-bubble { padding: 10px 12px; border-radius: 12px; max-width: 90%; font-size: 14px; line_height: 1.4; position: relative; }
  .rc-bubble.user { background: #1f2937; margin-left: auto; }
  .rc-bubble.bot { background: #111827; border: 1px solid rgba(255,255,255,0.06); }
  .rc-badge { position: absolute; top: -8px; right: -8px; font-size: 10px; padding: 3px 6px; border-radius: 999px; }
  .rc-badge.ia { background: #22c55e; color: #0b1220; }
  .rc-badge.local { background: #475569; color: #e2e8f0; }
  .rc-chat-form { display: flex; gap: 8px; padding: 10px; border-top: 1px solid rgba(255,255,255,0.08); background: #0f172a; }
  .rc-chat-form input { flex: 1; padding: 10px 12px; border-radius: 10px; border: 1px solid #1f2937; background: #0b1220; color: #e2e8f0; }
  .rc-chat-form button { background: #22c55e; color: #0b1220; border: none; border-radius: 10px; padding: 10px 14px; cursor: pointer; font-weight: 600; }
  @media (max-width: 640px) {
    .rc-chatbox { right: 12px; left: 12px; width: auto; }
    .rc-chat-toggle { right: 12px; }
  }
</style>
<script>
  (function() {
    const toggle = document.getElementById("rc-chat-toggle");
    const chat = document.getElementById("rc-chatbox");
    const closeBtn = document.getElementById("rc-chat-close");
    const form = document.getElementById("rc-chat-form");
    const input = document.getElementById("rc-chat-input");
    const messages = document.getElementById("rc-chat-messages");
    const endpoint = "/api/chatbot/";
    const t = {
      greeting: chat?.dataset.greeting || "Hello! I'm your RC assistant.",
      placeholder: chat?.dataset.placeholder || "Type your question...",
      error: chat?.dataset.error || "Connection error. Try again.",
    };

    if (input && t.placeholder) input.placeholder = t.placeholder;

    const append = (text, role, source) => {
      const div = document.createElement("div");
      div.className = `rc-bubble ${role}`;
      div.textContent = text;
      if (role === "bot" && source) {
        const badge = document.createElement("span");
        badge.className = `rc-badge ${source === "ia" ? "ia" : "local"}`;
        badge.textContent = source.toUpperCase();
        div.appendChild(badge);
      }
      messages.appendChild(div);
      messages.scrollTop = messages.scrollHeight;
    };

    toggle.addEventListener("click", () => {
      chat.style.display = "flex";
      input.focus();
      if (!messages.dataset.seeded) {
        append(t.greeting, "bot");
        messages.dataset.seeded = "1";
      }
    });
    closeBtn.addEventListener("click", () => chat.style.display = "none");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const text = input.value.trim();
      if (!text) return;
      append(text, "user");
      input.value = "";
      append("...", "bot");
      try {
        const resp = await fetch(endpoint, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ query: text })
        });
        const data = await resp.json();
        messages.lastChild.remove(); // remove placeholder
        append(data.message || t.error, "bot", data.source);
      } catch (err) {
        messages.lastChild.remove();
        append(t.error, "bot");
      }
    });
  })();
</script>
{% endblock %}
