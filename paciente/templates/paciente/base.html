{% load static i18n %}
{% get_current_language as CURRENT_LANG %}
<!DOCTYPE html>
<html lang="{{ CURRENT_LANG|default:'es' }}">

<head>
    <!-- ================================
         META & CONFIGURACIÃ“N BÃSICA
    ================================= -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>{% block ptitle %}Consultorio RC{% endblock %}</title>

    <!-- Fuentes -->
    <link
      href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=Space+Grotesk:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- Estilos globales del mÃ³dulo Paciente -->
    <link rel="stylesheet" href="{% static 'paciente/styles.css' %}" />

    <!-- Espacio para CSS adicional por pÃ¡gina -->
    {% block extra_css %}{% endblock %}
</head>

<body class="dark-mode" data-theme="dark">
    <!-- =====================================================================
         TOPBAR / BARRA SUPERIOR
         Esta barra es fija y aparece en todas las vistas del mÃ³dulo paciente.
    ====================================================================== -->
    <header class="topbar">
        <div class="topbar__inner">
            <!-- Nombre del consultorio -->
            <a href="/" class="brand">
              Consultorio Dental RC
            </a>

            <!-- Texto central, cambia segÃºn la vista -->
            <div class="center-title">
                {% block header_title %}Paciente{% endblock %}
            </div>

            <!-- AcciÃ³n de cerrar sesiÃ³n -->
            <div class="right-actions">
                <div class="topbar-toggle">
                    <button id="theme-toggle" class="chip-toggle" type="button" aria-label="Cambiar tema">
                        <span class="chip-icon">ðŸŒ™</span>
                        <span class="chip-label">Modo</span>
                    </button>
                </div>
                <div class="lang-switch">
                    <form action="{% url 'set_language' %}" method="post">
                        {% csrf_token %}
                        {% with path=request.get_full_path %}
                            {% if path|slice:":4" == "/en/" %}
                                <input name="next" type="hidden" value="{{ path|slice:'3:' }}">
                            {% else %}
                                <input name="next" type="hidden" value="{{ path }}">
                            {% endif %}
                        {% endwith %}
                        <input name="language" type="hidden" value="es">
                        <button type="submit" class="lang-pill {% if CURRENT_LANG|slice:':2' == 'es' %}active{% endif %}" aria-label="EspaÃ±ol (MX)">
                            <span class="flag flag-mx"></span>
                            <span class="flag-code">MX</span>
                        </button>
                    </form>
                    <form action="{% url 'set_language' %}" method="post">
                        {% csrf_token %}
                        <input name="next" type="hidden" value="{{ request.get_full_path }}">
                        <input name="language" type="hidden" value="en">
                        <button type="submit" class="lang-pill {% if CURRENT_LANG|slice:':2' == 'en' %}active{% endif %}" aria-label="English (US)">
                            <span class="flag flag-us"></span>
                            <span class="flag-code">US</span>
                        </button>
                    </form>
                </div>
                <form
                    action="{% url 'accounts:logout' %}"
                    method="post"
                    style="display:inline;"
                >
                    {% csrf_token %}
                    <button type="submit" class="btn-logout">
                        Cerrar sesiÃ³n
                    </button>
                </form>
            </div>
        </div>
    </header>

    <!-- ========================================================
         BANNER DE PENALIZACIÃ“N (si aplica)
         Se muestra automÃ¡ticamente si la vista manda penalizacion_info.
    ========================================================= -->
    {# Banner global de penalizaciÃ³n removido (se muestra solo en la vista de pagos) #}

    <!-- ========================================================
         SISTEMA GLOBAL DE ALERTAS - TARJETAS TIPO TOAST
         (mensajes de Ã©xito/error con auto-desvanecimiento)
    ========================================================= -->
    <div id="toast-container">
        <!-- Las tarjetas se insertarÃ¡n dinÃ¡micamente desde JS -->
    </div>

    <!-- ========================================================
         CONTENIDO PRINCIPAL DE CADA PÃGINA
    ========================================================= -->
    <main class="main-container">
        {% block pcontent %}{% endblock %}
    </main>

    <!-- ========================================================
         MODAL GLOBAL (genÃ©rico)
         Puede ser utilizado por distintas vistas.
    ========================================================= -->
    <div id="modal" class="modal-backdrop" hidden>
        <div class="modal-content">
            <header class="modal-header">
                <h3 id="modal-title" class="modal-title"></h3>
                <button class="modal-close" id="modalCloseBtn">âœ•</button>
            </header>
            <div id="modal-body" class="modal-body"></div>
        </div>
    </div>

    <!-- ========================================================
         SCRIPTS GENERALES
    ========================================================= -->
    <script src="{% static 'paciente/app.js' %}" defer></script>

    <!-- Scripts extra por vista -->
    {% block extra_js %}{% endblock %}
</body>
</html>
