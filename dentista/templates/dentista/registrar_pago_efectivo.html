{% extends "dentista/base.html" %}
{% load static %}

{% block dtitle %}Terminal de Cobro | RC Pro{% endblock %}

{% block dcontent %}

<div class="page-header">
    <div>
        <h1 class="text-gradient">Registrar Cobro</h1>
        <p class="welcome-subtitle">Seleccione una cita pendiente para procesar el pago.</p>
    </div>
    <div class="header-actions">
        <a href="{% url 'dentista:pagos' %}" class="cyber-btn cyber-btn-secondary">
            <i class="ph-bold ph-x"></i> Cancelar
        </a>
    </div>
</div>

<form method="post" id="paymentForm">
    {% csrf_token %}
    
    <input type="hidden" name="cita_id" id="selectedCitaId" required>

    <div class="pos-grid">
        
        <div>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <h3 style="font-size: 1rem; font-weight: 700; color: var(--text-muted); margin: 0;">CITAS PENDIENTES</h3>
                <span class="status-badge status-active">{{ citas_disponibles|length }}</span>
            </div>
            
            <div class="pending-list">
                {% for cita in citas_disponibles %}
                    <div class="pay-card" onclick="selectCita(this, '{{ cita.id }}', '{{ cita.servicio.precio }}', '{{ cita.paciente.nombre }}', '{{ cita.servicio.nombre }}')">
                        <div class="pc-header">
                            <span class="pc-name">{{ cita.paciente.nombre }}</span>
                            <span class="pc-date">{{ cita.fecha_hora_inicio|date:"d M" }} &bull; {{ cita.fecha_hora_inicio|time:"H:i" }}</span>
                        </div>
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-top: 5px;">
                            <span class="pc-service">{{ cita.servicio.nombre }}</span>
                            <span class="pc-price">${{ cita.servicio.precio }}</span>
                        </div>
                    </div>
                {% empty %}
                    <div style="text-align: center; padding: 4rem; color: var(--text-muted); border: 2px dashed var(--border-subtle); border-radius: 12px;">
                        <i class="ph-duotone ph-check-circle" style="font-size: 3rem; margin-bottom: 10px; color: var(--success);"></i>
                        <p>¡Todo al día! No hay cobros pendientes.</p>
                    </div>
                {% endfor %}
            </div>
        </div>

        <div class="checkout-panel">
            <div style="border-bottom: 1px solid var(--bg-input); padding-bottom: 1rem; margin-bottom: 1.5rem; text-align: center;">
                <span style="color: var(--brand); font-size: 0.8rem; text-transform: uppercase; font-weight: 800; letter-spacing: 1px;">
                    <i class="ph-fill ph-receipt"></i> Resumen de Venta
                </span>
            </div>

            <div style="margin-bottom: 2rem;">
                <div style="display:flex; justify-content:space-between; margin-bottom:10px; font-size:0.9rem;">
                    <span style="color:var(--text-muted);">Paciente:</span>
                    <span style="color:var(--text-main); font-weight:600; text-align: right;" id="summaryPatient">---</span>
                </div>
                <div style="display:flex; justify-content:space-between; margin-bottom:10px; font-size:0.9rem;">
                    <span style="color:var(--text-muted);">Servicio:</span>
                    <span style="color:var(--text-main); text-align: right;" id="summaryService">---</span>
                </div>
            </div>

            <div class="lbl-total">Total a Pagar</div>
            <div class="big-total" id="displayTotal">$0.00</div>

            <div class="form-group">
                <label style="font-size:0.75rem; font-weight: 700; color:var(--text-muted); text-transform: uppercase;">Monto Recibido</label>
                <input type="number" step="0.01" name="monto" id="inputMonto" class="cyber-input" style="text-align: center; font-size: 1.2rem; font-weight: bold; height: 50px;" required>
            </div>

            <div class="form-group">
                <label style="font-size:0.75rem; font-weight: 700; color:var(--text-muted); text-transform: uppercase;">Notas (Opcional)</label>
                <input type="text" name="notas" class="cyber-input" placeholder="Ej. Billete de $500...">
            </div>

            <button type="submit" id="btnCobrar" class="cyber-btn cyber-btn-glow w-100" style="margin-top: 1.5rem; padding: 1rem; justify-content: center;" disabled>
                <i class="ph-bold ph-cash-register"></i> Confirmar Cobro
            </button>
        </div>

    </div>
</form>

{% endblock %}